name: Deploy to Hugging Face Spaces

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check for HF_TOKEN
        run: |
          if [ -z "${{ secrets.HF_TOKEN }}" ]; then
            echo "⚠️ HF_TOKEN secret not found!"
            echo "Please add your Hugging Face token as a repository secret named 'HF_TOKEN'"
            echo "Get your token from: https://huggingface.co/settings/tokens"
            exit 1
          fi
          echo "✅ HF_TOKEN found!"

      - name: Set up Git identity
        run: |
          git config --global user.email "saadtoorx@example.com"
          git config --global user.name "saadtoorx"

      - name: Deploy to Hugging Face Spaces
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          echo "🚀 Deploying to Hugging Face Spaces..."
          git remote remove hf 2>/dev/null || true
          git remote add hf https://saadtoorx:$HF_TOKEN@huggingface.co/spaces/saadtoorx/multi-agent-job-application-crew
          git push hf main --force
          echo "✅ Successfully deployed to Hugging Face!"
